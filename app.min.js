"use strict";function init(a){createScene(),createDesk(a[0]),createLaptop(a[1]),renderer.render(scene,camera),animateEntrance(),setInterval(flashCameraLight,6e3),setInterval(cameraLightToggle,4e3),setCss()}function createScene(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,WIDTH<ASPECT_RATIO*HEIGHT?HEIGHT=WIDTH/ASPECT_RATIO:HEIGHT<WIDTH/ASPECT_RATIO&&(WIDTH=HEIGHT*ASPECT_RATIO),scene=new THREE.Scene,scene.fog=new THREE.Fog(16243114,100,950),light=new THREE.DirectionalLight(16777215),light.position.set(0,6,2).normalize(),scene.add(light),fieldOfView=60,near=1,far=1e4,camera=new THREE.PerspectiveCamera(fieldOfView,ASPECT_RATIO,near,far),camera.position.set(0,10,15),camera.lookAt(new THREE.Vector3(0,0,-2)),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),renderer.setSize(WIDTH,HEIGHT),renderer.shadowMap.enabled=!0,container=document.getElementById("world"),container.appendChild(renderer.domElement)}function handleWindowResize(){window.innerWidth>WIDTH&&(HEIGHT=window.innerHeight,WIDTH=window.innerWidth,renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix(),setCss())}function createDesk(a){var b=new Desk(a);b.mesh.position.z+=2.2,scene.add(b.mesh)}function createLaptop(a){a.wrapS=a.wrapT=THREE.RepeatWrapping,a.repeat.set(5,2),laptop=new Laptop(a),laptop.mesh.position.z=5,scene.add(laptop.mesh)}function roundedRect(a,b,c,d,e){var f=new THREE.Shape;return f.moveTo(a,b+e),f.lineTo(a,b+d-e),f.quadraticCurveTo(a,b+d,a+e,b+d),f.lineTo(a+c-e,b+d),f.quadraticCurveTo(a+c,b+d,a+c,b+d-e),f.lineTo(a+c,b+e),f.quadraticCurveTo(a+c,b,a+c-e,b),f.lineTo(a+e,b),f.quadraticCurveTo(a,b,a,b+e),f}function circle(a){var b=new THREE.Shape;return b.moveTo(0,a),b.quadraticCurveTo(a,a,a,0),b.quadraticCurveTo(a,-a,0,-a),b.quadraticCurveTo(-a,-a,-a,0),b.quadraticCurveTo(-a,a,0,a),b}function extrude(a,b){return new THREE.ExtrudeGeometry(a,{amount:b,bevelEnabled:!1})}function animateEntrance(){setTimeout(function(){$("#world").removeClass("hidden")},1e3),setTimeout(function(){$("#duckduckgo").removeClass("hidden"),setTimeout(function(){$("#search").removeClass("hidden").focus()},1400),$("#loading").addClass("hidden")},3e3)}function setCss(){var a=.33*WIDTH,b=.365*HEIGHT,c=(WIDTH-a)/2;$("#duckduckgo").css({top:.13*HEIGHT,height:b,left:c,width:a});var d=.23*WIDTH;$("#search").css({top:354*HEIGHT/H,height:35*HEIGHT/H,left:c+(a-d-60)/2,width:d})}function cameraLightToggle(){cameraOn=!cameraOn}function flashCameraLight(){laptop.mesh.children[3].visible=cameraOn,renderer.render(scene,camera)}var Colors={black:0,white:13487565,silver:10333357,table:12432256,tableLeg:5002324,green:65345};const loader=new THREE.TextureLoader,NINETY=Math.PI/2,W=1916,H=978,ASPECT_RATIO=W/H;var laptop,keyboard,cameraOn=!1;$(document).ready(function(){TW.loadTextures(["images/table.jpeg","images/speakers.jpg"],init)});var scene,camera,fieldOfView,aspectRatio,near,far,HEIGHT,WIDTH,renderer,container,light,Phone=function(){this.mesh=new THREE.Object3D;var a=new THREE.MeshPhongMaterial({color:Colors.black}),b=roundedRect(0,0,2.5,5,.2),c=extrude(b,.2),d=new THREE.MeshPhongMaterial({color:Colors.white}),e=new THREE.Mesh(c,d),f=new THREE.EdgesGeometry(e.geometry),g=new THREE.LineBasicMaterial({color:Colors.silver,linewidth:4}),h=new THREE.LineSegments(f,g);e.add(h),e.rotation.x=NINETY,e.position.set(-1.25,1,-2.5),this.mesh.add(e);var i=new THREE.BoxGeometry(2.3,3.8,.1),j=new THREE.Mesh(i,a);j.rotation.x=NINETY,j.position.y=1,this.mesh.add(j);var k=extrude(circle(.2),.04),l=new THREE.Mesh(k,new THREE.MeshPhongMaterial({color:11250603}));l.rotation.x=NINETY,l.position.set(0,1.1,2.15),this.mesh.add(l);var m=extrude(circle(.05),.04),n=new THREE.Mesh(m,a);n.rotation.x=NINETY,n.position.set(-.4,1.1,-2.15),this.mesh.add(n);var o=extrude(circle(.04),.04),p=new THREE.Mesh(o,a);p.rotation.x=NINETY,p.position.set(0,1.1,-2.35),this.mesh.add(p);var q=new THREE.BoxGeometry(.05,.5,.1),r=new THREE.Mesh(q,a);r.rotation.set(NINETY,0,NINETY),r.position.set(0,1.1,-2.1),this.mesh.add(r)},Laptop=function(a){this.mesh=new THREE.Object3D;var b=roundedRect(0,0,9,14,.5),c=extrude(b,.3),d=new THREE.MeshPhongMaterial({color:Colors.silver}),e=new THREE.Mesh(c,d);e.rotation.set(NINETY,0,-NINETY),e.position.set(-7,.85,4),this.mesh.add(e),keyboard=new Keyboard,this.mesh.add(keyboard.mesh);var f=roundedRect(0,0,9,14,.5),g=extrude(f,.1),h=new THREE.MeshPhongMaterial({color:Colors.black}),i=new THREE.Mesh(g,h);i.rotation.set(-NINETY/3,0,-NINETY),i.position.set(-7,8.2,-9.5);var j=new THREE.EdgesGeometry(i.geometry),k=new THREE.LineBasicMaterial({color:Colors.silver,linewidth:2}),l=new THREE.LineSegments(j,k);i.add(l),i.name="screen",this.mesh.add(i);var m=extrude(circle(.05),.1),n=new THREE.Mesh(m,new THREE.MeshPhongMaterial({color:Colors.green}));n.position.set(.5,7.85,-9.1),n.rotation.set(-NINETY/3,2*NINETY,0),n.name="light",n.visible=!1,this.mesh.add(n);var o=new THREE.MeshPhongMaterial({color:9280669}),p=roundedRect(-1.6,-2,3,4,.2),q=extrude(p,.1),r=new THREE.Mesh(q,o);r.rotation.set(NINETY,0,-NINETY),r.position.set(0,.9,2),this.mesh.add(r);var s=roundedRect(-2.15,-5.35,4.2,10.7,.2),t=extrude(s,.1),u=new THREE.Mesh(t,o);u.rotation.set(NINETY,0,-NINETY),u.position.set(0,.9,-2),this.mesh.add(u);for(var v=new THREE.BoxGeometry(3.8,1,.01),w=new THREE.MeshPhongMaterial({color:Colors.silver,map:a}),x=-1;x<2;x+=2){var y=new THREE.Mesh(v,w);y.rotation.set(NINETY,0,-NINETY),y.position.set(6*x,.9,-2),this.mesh.add(y)}},Keyboard=function(){this.mesh=new THREE.Object3D,this.keyState=Array(77).fill(!1);const a={n:.5,fn:.528,tab:.9,enter:1.05,shift:1.38,space:3.3,cmd:.7,arrow:.5},b={n:0,fn:0,tab:.2,enter:.3,shift:.44,space:1.4,cmd:.1,arrow:0};var c=-3.75;const d=new THREE.MeshBasicMaterial({color:Colors.black}),e=[Array(14).fill("fn"),Array(13).fill("n").concat("tab"),["tab"].concat(Array(13).fill("n")),["enter"].concat(Array(11).fill("n")).concat("enter"),["shift"].concat(Array(10).fill("n")).concat("shift"),["n","n","n","cmd","space","cmd","n","arrow","n","arrow"]];var f,g,h,i,j,k,l,m,n,o=new THREE.LineBasicMaterial({color:1842719,linewidth:1});for(g=0;g<e.length;g++){for(f=-4.7,h=0;h<e[g].length;h++){i=e[g][h],m="fn"==i||"arrow"==i?.3:.5,n=a[i],j=roundedRect(-m/2,-n/2,m,n,.1),k=extrude(j,.1),l=new THREE.Mesh(k,d),l.name=i,function(a){a.rotation.set(NINETY,0,-NINETY),a.position.y=1.1}(l),l.position.z=c+("arrow"===i?.1:0),l.position.y+=.01,l.position.x=f+b[i],f+=.2+a[i];var p=new THREE.EdgesGeometry(l.geometry),q=new THREE.LineSegments(p,o);l.add(q),this.mesh.add(l)}c+=0===g?.6:.7}$(document).on("keyup",this.release.bind(this)),$(document).on("keydown",this.press.bind(this))};Keyboard.prototype.press=function(a){var b=KEY_MAPS[a.which];if(this.keyState[b])20==a.which&&this.release(a);else{this.keyState[b]=!0;this.mesh.children[b].position.y-=.05,renderer.render(scene,camera)}},Keyboard.prototype.release=function(a){var b=KEY_MAPS[a.which];if(this.keyState[b]){this.keyState[b]=!1;this.mesh.children[b].position.y+=.05,renderer.render(scene,camera)}};var Desk=function(a){this.mesh=new THREE.Object3D;var b=new THREE.BoxGeometry(15,20,1),c=new THREE.MeshPhongMaterial({color:Colors.table,map:a}),d=new THREE.Mesh(b,c);d.rotation.set(NINETY,0,NINETY),this.mesh.add(d);for(var e=[8,8,-8,-8],f=[5.5,-5.5,5.5,-5.5],g=0;g<4;g++){var h=new THREE.CylinderGeometry(1,1,25),i=new THREE.MeshPhongMaterial({color:Colors.tableLeg}),j=new THREE.Mesh(h,i);j.position.set(e[g],-12.5,f[g]),this.mesh.add(j)}},BTKeyboard=function(){this.mesh=new THREE.Object3D;var a=roundedRect(0,0,4.6,10.7,.5),b=extrude(a,.2),c=new THREE.MeshPhongMaterial({color:3159350}),a=new THREE.Mesh(b,c);a.rotation.set(NINETY,0,NINETY),a.position.set(5.4,1,-2.4),this.mesh.add(a);var d=new Keyboard;d.mesh.position.set(0,.01,2),this.mesh.add(d.mesh)},TW={REVISION:"27"},cs307=TW;"object"==typeof module&&(module.exports=cs307),TW.debug=!1,TW.WHITE=16777215,TW.SILVER=12632256,TW.GRAY=8421504,TW.BLACK=0,TW.RED=16711680,TW.MAROON=8388608,TW.LIME=65280,TW.GREEN=32768,TW.BLUE=255,TW.NAVY=128,TW.YELLOW=16776960,TW.OLIVE=8421376,TW.FUCHSIA=16711935,TW.MAGENTA=16711935,TW.PURPLE=8388736,TW.AQUA=65535,TW.CYAN=65535,TW.TEAL=32896,TW.ORANGE=16753920,TW.makeColor=function(a,b,c,d){function e(a){if(0<=a&&a<=1)return Math.round(255*a);throw"primary not in [0,1]"}var f=65536*e(a)+256*e(b)+e(c);if(d||TW.debug){var g=f.toString(16);g.length<6&&(g="0"+g),console.log("r: "+a+" g: "+b+" b: "+c+" hexString: 0x"+g+" int: "+f)}return f},TW.keyboard_callbacks=[],TW.keyboard_callbacks_docs=[],TW.setKeyboardCallback=function(a,b,c,d){var e;if(TW.debug&&console.log("set kbd: "+a+","+(d?"shared":"not-shared")),d)var e=TW;else var e=TW.lastClickTarget.TW_state;var f=a.charCodeAt(0);e.keyboard_callbacks[f]=b,e.keyboard_callbacks_docs[f]=c,e.keyboard_callbacks[a]=c+(d?" shared":" not-shared")},TW.showKeyboardCallbacks=function(){var a,b=TW.lastClickTarget.TW_state,c=b.keyboard_callbacks_docs,d=c.length,e="Current keyboard callbacks:\n";for(a=0;a<d;a++)c[a]&&(e+=String.fromCharCode(a)+": "+c[a]+"\n");alert(e)},TW.render=function(){var a=TW.lastClickTarget.TW_state;a.render?a.render():console.log("No render function in the state object; \nThis is defined by TW.cameraSetup().\nhave you used it?")},TW.toggleAxes=function(a){var b=TW.lastClickTarget.TW_state;b.axisHelper.visible="show"===a||"hide"!==a&&!b.axisHelper.visible,b.render()},TW.toggleBoundingBox=function(a){var b=TW.lastClickTarget.TW_state;b.sceneBoundingBoxHelper.visible="show"===a||"hide"!==a&&!b.sceneBoundingBoxHelper.visible,b.render()},TW.toggleGroundPlane=function(a){var b=TW.lastClickTarget.TW_state;b.ground.visible="show"===a||"hide"!==a&&!b.ground.visible,b.render()},TW.onkeypress=function(a){if(TW.lastClickTarget){var b=TW.lastClickTarget,c=a.charCode;TW.debug&&console.log("keypress: "+String.fromCharCode(c)+" on canvas id: "+b.id);var d=b.TW_state.keyboard_callbacks;"function"==typeof d[c]&&d[c](a)}},TW.createMesh=function(a){var b=new THREE.MeshNormalMaterial;b.side=THREE.DoubleSide;var c=new THREE.MeshBasicMaterial;return c.wireframe=!0,THREE.SceneUtils.createMultiMaterialObject(a,[b,c])},TW.makeSphereAt=function(a,b){var c=TW.createMesh(new THREE.SphereGeometry(b||1));return c.position.copy(a),c},TW.degrees2radians=function(a){return Math.PI/180*a},TW.radians2degrees=function(a){return 180/Math.PI*a},TW.hypotenuseOf=function(a,b){return a/Math.sin(b)},TW.addQuadFace=function(a,b,c,d,e){a.faces.push(new THREE.Face3(b,c,d)),a.faces.push(new THREE.Face3(d,e,b))},TW.setMaterialForFaces=function(a,b,c){var d,e,f,g=a.faces;if(c instanceof Array)f=c,d=0;else{if("number"!=typeof c)throw"faceIndexes must be a list or the first of some numbers";f=arguments,d=2}for(e=f.length;d<e;++d){var h=f[d];TW.debug&&console.log("setting face "+h+" to material "+b),g[h].materialIndex=b}},TW.setMaterialForFaces11=function(a){var b,c=a.faces.length;for(b=0;b<c;++b)a.faces[b].materialIndex=b},TW.randomColor=function(){return new THREE.Color(Math.random(),Math.random(),Math.random())},TW.computeFaceColors=function(a){if(!(a instanceof THREE.Geometry))throw"TW.computeFaceColors needs a geometry object";var b,c=a.vertexColors,d=a.faces,e=d.length;for(b=0;b<e;++b){var f=d[b],g=[];g[0]=c[f.a],g[1]=c[f.b],g[2]=c[f.c],f.vertexColors=g}},TW.addAxisHelper=function(a,b,c){var d=TW.lastClickTarget.TW_state,e=new THREE.AxisHelper(b);e.material.linewidth=c,e.name="AxisHelper",e.visible=!1,a.add(e),d.axisHelper=e},TW.sceneBoundingBoxColor=TW.YELLOW,TW.addSceneBoundingBoxHelper=function(a){var b=TW.sceneBoundingBoxColor,c=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:b,wireframe:!0})),d=TW.lastClickTarget.TW_state,e=d.cameraParams;c.scale.set(e.xSize,e.ySize,e.zSize),c.position.copy(e.center),c.visible=!1,c.name="BoundingBoxHelper",a.add(c),d.sceneBoundingBoxHelper=c},TW.groundColor=32768,TW.addGroundHelper=function(a,b){var c=new THREE.PlaneGeometry(b.maxx-b.minx,b.maxz-b.minz),d=new THREE.MeshBasicMaterial({color:TW.groundColor,side:THREE.DoubleSide}),e=new THREE.Mesh(c,d);e.position.set(.5*(b.maxx+b.minx),b.miny,.5*(b.maxz+b.minz)),e.rotation.x=-.5*Math.PI,e.visible=!1,e.name="Ground",a.add(e),TW.lastClickTarget.TW_state.ground=e},TW.viewFromFront=function(){var a=TW.lastClickTarget.TW_state,b=a.cameraParams,c=b.center;a.cameraObject.position.set(c.x,c.y,c.z+b.cameraRadius),a.cameraObject.lookAt(c),a.render()},TW.viewFromSide=function(){var a=TW.lastClickTarget.TW_state,b=a.cameraParams,c=b.center;a.cameraObject.position.set(c.x+b.cameraRadius,c.y,c.z),a.cameraObject.lookAt(c),a.render()},TW.viewFromAbove=function(){var a=TW.lastClickTarget.TW_state,b=a.cameraParams,c=b.center;a.cameraObject.position.set(c.x,c.y+b.cameraRadius,c.z),a.cameraObject.lookAt(c),a.render()},TW.viewFromAboveFrontSide=function(){var a=TW.lastClickTarget.TW_state,b=a.cameraParams,c=b.center,d=b.cameraRadius,e=d/Math.sqrt(3);a.cameraObject.position.set(c.x+e,c.y+e,c.z+e),a.cameraObject.lookAt(c),a.render()},TW.clearColor=14540253,TW.mainInit=function(a,b,c){if(!a instanceof THREE.WebGLRenderer)throw"first argument doesn't seem to be a renderer: "+a;if(!b instanceof THREE.Scene)throw"second argument doesn't seem to be a scene: "+b;if(!a||!a.domElement||"CANVAS"!==a.domElement.nodeName)return void console.log("couldn't find canvas in renderer");void 0===c&&(c={});var d=a.domElement;TW.lastClickTarget=d;var e={};d.TW_state=e,e.renderer=a,e.scene=b,c.parentID&&(c.parent=document.getElementById(c.parentID)),(c.parent||document.body).appendChild(d),a.setSize(d.clientWidth,d.clientHeight),a.setClearColor(TW.clearColor,1);var f=c.axisLength||20;TW.addAxisHelper(b,f,5),e.keyboard_callbacks=TW.keyboard_callbacks.slice(0),e.keyboard_callbacks_docs=TW.keyboard_callbacks_docs.slice(0)},TW.isValidBB=function(a){return"number"==typeof a.minx&&"number"==typeof a.miny&&"number"==typeof a.minz&&"number"==typeof a.maxx&&"number"==typeof a.maxy&&"number"==typeof a.maxz&&a.minx<=a.maxx&&a.miny<=a.maxy&&a.minz<=a.maxz},TW.cameraSetupParams=function(a,b){if(!TW.isValidBB(a))throw"first arg is not a valid bounding box";if(!b||isNaN(b))throw"fovy is missing or invalid: "+b;var c=a,d=c.maxx-c.minx,e=c.maxy-c.miny,f=c.maxz-c.minz,g=Math.sqrt(d*d+e*e+f*f),h=g/2,i=TW.degrees2radians(b),j=h/Math.sin(i/2);return{xSize:d,ySize:e,zSize:f,center:new THREE.Vector3(.5*(c.maxx+c.minx),.5*(c.maxy+c.miny),.5*(c.maxz+c.minz)),fovyRadians:i,sceneDiameter:g,sceneRadius:h,cameraRadius:j,near:j-h,far:j+h}},TW.cameraSetup=function(a,b,c,d){if(!(a instanceof THREE.WebGLRenderer))throw"first arg should be a renderer, probably THREE.WebGLRenderer";if(!(b instanceof THREE.Scene))throw"second arg must be a THREE.Scene";var e=c;e||console.log("without the scene bounding box, I have no idea where to position the camera.\nPlease supply a bounding box like {minx: 0, maxx: 100, ...}");var f=d&&d.fovy?d.fovy:75;null===TW.lastClickTarget&&(console.warn("It seems that you did not invoke TW.mainInit; doing it for you."),TW.mainInit(a,b));var g=TW.lastClickTarget,h=g.TW_state;h.sceneBoundingBox=c;var i=TW.cameraSetupParams(c,f);h.cameraParams=i;var j=new THREE.PerspectiveCamera(f,g.clientWidth/g.clientHeight,.5*i.near,2*i.far);h.cameraObject=j,b.add(j);var k=b.getObjectByName("AxisHelper");if(null==k)throw"Your scene has no AxisHelper, which means it wasn't created by TW.mainInit().";if(k.size=i.sceneRadius,TW.addSceneBoundingBoxHelper(b),TW.addGroundHelper(b,e),h.render=function(){a.render(b,j)},"function"==typeof THREE.OrbitControls){var l=new THREE.OrbitControls(j,g);h.cameraControls=l,l.addEventListener("change",h.render),l.target.copy(i.center),l.update()}return TW.viewFromFront(),h.render(),h},TW.camera=function(){console.log("TW.camera is obsolete. Please use TW.cameraSetup instead."),TW.cameraSetup.apply(this,arguments)},TW.createBarn=function(a,b,c){var d=a,e=b,f=c,g=new THREE.Geometry;return g.vertices.push(new THREE.Vector3(0,0,0)),g.vertices.push(new THREE.Vector3(d,0,0)),g.vertices.push(new THREE.Vector3(d,e,0)),g.vertices.push(new THREE.Vector3(0,e,0)),g.vertices.push(new THREE.Vector3(.5*d,e+.5*d,0)),g.vertices.push(new THREE.Vector3(0,0,-f)),g.vertices.push(new THREE.Vector3(d,0,-f)),g.vertices.push(new THREE.Vector3(d,e,-f)),g.vertices.push(new THREE.Vector3(0,e,-f)),g.vertices.push(new THREE.Vector3(.5*d,e+.5*d,-f)),g.faces.push(new THREE.Face3(0,1,2)),g.faces.push(new THREE.Face3(0,2,3)),g.faces.push(new THREE.Face3(3,2,4)),g.faces.push(new THREE.Face3(5,7,6)),g.faces.push(new THREE.Face3(5,8,7)),g.faces.push(new THREE.Face3(7,8,9)),g.faces.push(new THREE.Face3(3,4,8)),g.faces.push(new THREE.Face3(4,9,8)),g.faces.push(new THREE.Face3(2,7,9)),g.faces.push(new THREE.Face3(4,2,9)),g.faces.push(new THREE.Face3(6,2,1)),g.faces.push(new THREE.Face3(7,2,6)),g.faces.push(new THREE.Face3(0,3,5)),g.faces.push(new THREE.Face3(3,8,5)),g.faces.push(new THREE.Face3(0,5,1)),g.faces.push(new THREE.Face3(5,6,1)),g.computeFaceNormals(),g},TW.createWireBarn=function(a,b,c,d){function e(a,b,c){f(a,c),f(b,c)}function f(a,b){var c=new THREE.Vector3;c.copy(k[a]),l.vertices.push(c),l.colors.push(new THREE.Color(b))}var g=a,h=b,i=c,j=d||3,k=[];k[0]=new THREE.Vector3(0,0,0),k[1]=new THREE.Vector3(g,0,0),k[2]=new THREE.Vector3(g,h,0),k[3]=new THREE.Vector3(0,h,0),k[4]=new THREE.Vector3(.5*g,h+.5*g,0),k[5]=new THREE.Vector3(0,0,-i),k[6]=new THREE.Vector3(g,0,-i),k[7]=new THREE.Vector3(g,h,-i),k[8]=new THREE.Vector3(0,h,-i),k[9]=new THREE.Vector3(.5*g,h+.5*g,-i);var l=new THREE.Geometry,m=16711680;e(0,1,m),e(2,3,m),e(3,4,m),e(4,2,m),e(5,6,m),e(7,8,m),e(8,9,m),e(9,7,m),e(1,2,65280),e(3,0,65280),e(5,8,65280),e(6,7,65280),e(0,5,255),e(1,6,255),e(2,7,255),e(3,8,255),e(4,9,255);var n=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,linewidth:j}),o=new THREE.LineSegments(l,n),p=new THREE.Object3D;p.add(o);var q=new THREE.Mesh(new THREE.SphereGeometry(.4,8,8),new THREE.MeshBasicMaterial({color:16777215}));return p.add(q),p},TW.wireCube=function(a){a instanceof THREE.Color||(a=new THREE.Color(a));var b=a.getHex(),c=new THREE.BoxGeometry(1,1,1),d=new THREE.MeshBasicMaterial({color:b});return d.wireframe=!0,new THREE.Mesh(c,d)},TW.createBarnSolidColor=function(a,b,c,d){d instanceof THREE.Color||(d=new THREE.Color(d));var e=d.getHex();console.log("barn color is "+e);var f=TW.createBarn(a,b,c),g=new THREE.MeshBasicMaterial({color:e});return new THREE.Mesh(f,g)},TW.createBarnMultipleMaterials=function(a,b,c){var d=TW.createBarn(a,b,c);return TW.setMaterialForFaces(d,0,0,1,2,3,4,5),TW.setMaterialForFaces(d,2,6,7,8,9),TW.setMaterialForFaces(d,1,10,11,12,13),TW.setMaterialForFaces(d,3,14,15),d},TW.createColorCube=function(){var a=[];a[0]=new THREE.Color(0,0,0),a[1]=new THREE.Color(0,0,1),a[2]=new THREE.Color(0,1,0),a[3]=new THREE.Color(0,1,1),a[4]=new THREE.Color(1,0,0),a[5]=new THREE.Color(1,0,1),a[6]=new THREE.Color(1,1,0),a[7]=new THREE.Color(1,1,1);var b=[];b[0]=new THREE.Vector3(0,0,0),b[1]=new THREE.Vector3(0,0,1),b[2]=new THREE.Vector3(0,1,0),b[3]=new THREE.Vector3(0,1,1),b[4]=new THREE.Vector3(1,0,0),b[5]=new THREE.Vector3(1,0,1),b[6]=new THREE.Vector3(1,1,0),b[7]=new THREE.Vector3(1,1,1);var c=new THREE.Geometry;c.vertices=b,c.vertexColors=a,TW.addQuadFace(c,1,5,7,3),TW.addQuadFace(c,2,3,7,6),TW.addQuadFace(c,0,1,3,2),TW.addQuadFace(c,4,6,7,5),TW.addQuadFace(c,0,4,5,1),TW.addQuadFace(c,0,2,6,4),TW.computeFaceColors(c);var d=new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,side:THREE.DoubleSide});return new THREE.Mesh(c,d)},TW.createHSLPyramid=function(a,b){if(a<3)throw"number of wedges for a pyramid must be at least 3";var c=new THREE.Geometry;c.vertexColors=[],c.vertices.push(new THREE.Vector3(0,0,b)),c.vertexColors.push(0==b?new THREE.Color(0,0,0):new THREE.Color(1,1,1)),c.vertexColors.push(new THREE.Color(.5,.5,.5)),c.vertices.push(new THREE.Vector3(0,0,.5));var d;for(d=0;d<a;++d){var e=d/a,f=new THREE.Color;f.setHSL(e,1,.5);var g=2*e*Math.PI,h=Math.cos(g),i=Math.sin(g);c.vertices.push(new THREE.Vector3(h,i,.5)),c.vertexColors.push(f)}var j=a+1;for(d=3;d<=j;++d)c.faces.push(new THREE.Face3(0,d,d-1)),c.faces.push(new THREE.Face3(1,d-1,d));c.faces.push(new THREE.Face3(0,2,j)),c.faces.push(new THREE.Face3(1,j,2)),TW.computeFaceColors(c);var k=new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,side:THREE.DoubleSide});return new THREE.Mesh(c,k)},TW.createHLSPyramid=TW.createHSLPyramid,TW.matrix4x4toString=function(a,b){a instanceof THREE.Object3D&&(a=a.matrix);var c;a instanceof THREE.Matrix4&&(c=a.elements),void 0===b&&(b=1e-5);var d=c.length;if(16!=d)throw"should be called on a 4x4 matrix or an Object3D";var e="",f=0;for(f=0;f<d;f+=4){e+="| "+(Math.abs(c[f+0])<b?0:c[f+0])+" "+(Math.abs(c[f+1])<b?0:c[f+1])+" "+(Math.abs(c[f+2])<b?0:c[f+2])+" "+(Math.abs(c[f+3])<b?0:c[f+3])+" |\n"}return e},THREE.Camera.prototype.showMatrix=function(){var a=this.matrix.elements;console.log("|"+a[0]+" "+a[1]+" "+a[2]+" "+a[3]+"|"),console.log("|"+a[4]+" "+a[5]+" "+a[6]+" "+a[7]+"|"),console.log("|"+a[8]+" "+a[9]+" "+a[10]+" "+a[11]+"|"),console.log("|"+a[12]+" "+a[13]+" "+a[14]+" "+a[15]+"|")},TW.createFrustumFOV=function(a,b,c,d){var e=c*Math.tan(TW.degrees2radians(a)/2),f=-e,g=b*e,h=-g;return TW.debug&&(console.log("camera:",a,b,c,d),console.log("frustum:",g,h,e,f,c,d)),TW.createFrustum(g,h,e,f,c,d)},TW.createFrustum=function(a,b,c,d,e,f){function g(a,b,c){h(a,c),h(b,c)}function h(a,b){var c=new THREE.Vector3;c.copy(l[a]),i.vertices.push(c),i.colors.push(new THREE.Color(b))}var i=new THREE.Geometry,j=new THREE.LineBasicMaterial({color:16777215,linewidth:3,vertexColors:THREE.FaceColors}),k=f/e,l={ltn:new THREE.Vector3(a,c,e),lbn:new THREE.Vector3(a,d,e),rbn:new THREE.Vector3(b,d,e),rtn:new THREE.Vector3(b,c,e),ltf:new THREE.Vector3(k*a,k*c,f),lbf:new THREE.Vector3(k*a,k*d,f),rbf:new THREE.Vector3(k*b,k*d,f),rtf:new THREE.Vector3(k*b,k*c,f)};return g("ltn","lbn",TW.RED),g("lbn","rbn",TW.RED),g("rbn","rtn",TW.RED),g("rtn","ltn",TW.RED),g("ltf","lbf",TW.LIME),g("lbf","rbf",TW.LIME),g("rbf","rtf",TW.LIME),g("rtf","ltf",TW.LIME),g("ltf","ltn",TW.BLUE),g("lbf","lbn",TW.BLUE),g("rbf","rbn",TW.BLUE),g("rtf","rtn",TW.BLUE),new THREE.Line(i,j,THREE.LinePieces)},TW.TeddyBearParams=function(){if(this==window||this==TW||void 0==this)throw"I think you forgot to invoke TeddyBearParams with the 'new' operator";return this.wireframe=!1,this.sphereDetail=10,this.cylinderDetail=10,this.nose=!0,this.noseRadius=.5,this.noseRotation=TW.degrees2radians(10),this.ears=!0,this.earRadius=.6,this.earScale=.5,this.earAngle=Math.PI/4,this.eyes=!0,this.eyeRadius=.3,this.eyeAngleX=-Math.PI/6,this.eyeAngleY=+Math.PI/6,this.arms=!0,this.armLength=7,this.armRadiusTop=1.5,this.armRadiusBottom=1.2,this.legs=!0,this.legRadiusTop=1.8,this.legRadiusBottom=1.4,this.legLength=9,this.legRotationX=-TW.degrees2radians(60),this.legRotationZ=TW.degrees2radians(20),this.hipWidth=2.5,this.hipHeight=-7,this.head=!0,this.headRadius=2,this.bodyRadius=5,this.bodyScaleY=2,this.bodyColor="#D08050",this.headColor="#B07040",this.bodyMaterial=new THREE.MeshBasicMaterial({color:this.bodyColor}),this.headMaterial=new THREE.MeshBasicMaterial({color:this.headColor}),this.blackMaterial=new THREE.MeshBasicMaterial({color:0}),this},TW.createTeddyBear=function(a){function b(a){var b=a.sphereDetail||10,c=a.noseRadius||.6,d=new THREE.SphereGeometry(c,b,b),e=new THREE.Mesh(d,n);return e.name="nose",e}function c(a,c){var d=new THREE.Object3D,e=b(c),f=c.headRadius||2;e.position.z=f,d.add(e);var g=c.noseRotation||TW.degrees2radians(10);return d.rotation.x=g,a.add(d),a}function d(a){var b=a.sphereDetail||10,c=a.earRadius||.6,d=new THREE.SphereGeometry(c,b,b),e=new THREE.Mesh(d,l);return e.scale.z=a.earScale||.5,e}function e(a,b,c){var e=new THREE.Object3D,f=d(b);f.name=1==c?"right ear":"left ear";var g=b.headRadius||2,h=b.earAngle||Math.PI/4;return f.position.x=c*g,e.rotation.z=c*h,e.add(f),a.add(e),a}function f(a){var b=a.sphereDetail||10,c=a.eyeRadius||.3,d=new THREE.SphereGeometry(c,b,b);return new THREE.Mesh(d,n)}function g(a,b,c){var d=new THREE.Object3D,e=f(b),g=b.headRadius||2;e.position.z=g;var h=b.eyeAngleX||-Math.PI/6,i=b.eyeAngleY||Math.PI/6;return d.rotation.x=h,d.rotation.y=c*i,d.name=1==c?"right eye":"left eye",d.add(e),a.add(d),a}function h(a,b,c,d){var e=new THREE.Object3D,f=d.cylinderDetail||10,g=new THREE.CylinderGeometry(a,b,c,f),h=new THREE.Mesh(g,m);return h.position.y=-c/2,e.add(h),e}function i(a,b,c){var d=b.armRadiusTop||.7,e=b.armRadiusBottom||.6,f=b.armLength||5,g=h(d,e,f,b),i=b.bodyRadius||3,j=b.bodyScaleY||2,k=b.shoulderWidth||.5*i,l=b.shoulderHeight||j*i*.7;g.position.set(c*k,l,0),g.rotation.z=c*Math.PI/2,g.name=1==c?"right arm":"left arm",a.add(g)}function j(a,b,c){var d=b.legRadiusTop||.7,e=b.legRadiusBottom||.6,f=b.legLength||5,g=h(d,e,f,b);g.name=1==c?"right leg":"left leg";var i=b.bodyRadius||3,j=b.bodyScaleY||2,k=c*b.hipWidth||c*i*.5,l=b.hipHeight||j*i*-.7;g.position.set(k,l,0),g.rotation.x=b.legRotationX,g.rotation.z=c*b.legRotationZ,a.add(g)}var k=new THREE.Object3D,l=a.bodyMaterial,m=a.headMaterial,n=a.blackMaterial,o=function(a){var b=new THREE.Object3D,c=a.bodyRadius||3,d=a.sphereDetail||20,e=new THREE.SphereGeometry(c,d,d),f=new THREE.Mesh(e,l),g=a.bodyScaleY||2;return f.scale.y=g,b.add(f),a.arms&&(i(b,a,1),i(b,a,-1)),a.legs&&(j(b,a,1),j(b,a,-1)),b}(a);if(k.add(o),a.head){var p=function(a){var b=new THREE.Object3D,d=a.sphereDetail||10,f=a.headRadius||2,h=new THREE.SphereGeometry(f,d,d),i=new THREE.Mesh(h,m);return i.name="head",b.add(i),a.nose&&c(b,a),a.ears&&(e(b,a,1),e(b,a,-1)),a.eyes&&(g(b,a,1),g(b,a,-1)),b}(a),q=a.bodyScaleY||2,r=a.bodyRadius||3,s=a.headRadius||1;p.position.y=q*r+s,k.add(p)}return k},TW.convertMousePositionToNDC=function(a){var b=a.clientX,c=a.clientY,d=a.target,e=d.getBoundingClientRect(),f=b-e.left,g=c-e.top,h=e.width||e.right-e.left,i=e.height||e.bottom-e.top,j=h/2,k=i/2;return{mx:b,my:c,cx:f,cy:g,winXSize:h,winYSize:i,x:(f-j)/j,y:(k-g)/k}},TW.lastClickTarget=null,TW.storeClickTarget=function(a){"CANVAS"===a.target.nodeName&&(TW.lastClickTarget=a.target)},document.addEventListener("click",TW.storeClickTarget,!1),document.addEventListener("keypress",TW.onkeypress,!1),TW.setKeyboardCallback("?",TW.showKeyboardCallbacks,"show keyboard callbacks",!0),TW.setKeyboardCallback("a",TW.toggleAxes,"toggle axes",!0),TW.setKeyboardCallback("b",TW.toggleBoundingBox,"toggle scene bounding box",!0),TW.setKeyboardCallback("g",TW.toggleGroundPlane,"toggle ground plane",!0),TW.setKeyboardCallback("x",TW.viewFromSide,"view from side (+X)",!0),TW.setKeyboardCallback("y",TW.viewFromAbove,"view from above (+Y)",!0),TW.setKeyboardCallback("z",TW.viewFromFront,"view from front (+Z)",!0),TW.setKeyboardCallback("o",TW.viewFromAboveFrontSide,"view obliquely, from above front side (+XYZ)",!0),TW.power2=function(a){if(0<=a&&a<=31)return 1<<a;throw"invalid power of two: "+a},TW.nextPowerOf2=function(a){return Math.round(Math.exp(Math.log(2)*Math.ceil(Math.log(a)/Math.log(2))))},TW.createCheckerboardGray=function(a){var b,c,d=TW.power2(a),e=0,f=new Uint8Array(d*d);for(b=0;b<d;++b)for(c=0;c<d;++c)f[e++]=(1&b)!=(1&c)?255:0;return f},TW.createCheckerboardRedWhite=function(a){var b,c,d=TW.power2(a),e=new Uint8Array(3*d*d),f=0;for(b=0;b<d;++b)for(c=0;c<d;++c)(1&b)!=(1&c)?(e[f++]=255,e[f++]=0,e[f++]=0):(e[f++]=0,e[f++]=0,e[f++]=0);return e},TW.isArray2D=function(a){var b=a.length;if(!b)throw"array does not have length defined; is it even an array? "+a;var c=a.width;if(!c)throw"array does not have width defined: "+a;var d=a.height;if(!d)throw"array does not have height defined: "+a;if(b!=c*d)throw"array's width and height don't multiply to yield the length: "+a;return!0},TW.rowMajorAref=function(a,b,c){TW.isArray2D(a);var d=a.height,e=a.width;if(b>d)throw"array row out of bounds: "+b+" > "+d;if(c>e)throw"array col out of bounds: "+c+" > "+e;return a[b*e+c]},TW.rowMajorAset=function(a,b,c,d){TW.isArray2D(a);var e=a.height,f=a.width;if(b>e)throw"array row out of bounds: "+b+" > "+e;if(c>f)throw"array col out of bounds: "+c+" > "+f;a[b*f+c]=d},TW.createUSFlagGray=function(a){function b(a,b){var c,d,e=a*i,f=(a+1)*i;for(c=e;c<f;c++)for(d=0;d<k;d++)TW.rowMajorAset(h,c,d,b)}var c,d,e=TW.power2(a),f=2*e,g=f*e,h=new Uint8Array(g);for(h.width=f,h.height=e,c=0;c<g;c++)h[c]=128;var i=Math.floor(e/13);if(i<1)throw"size isn't big enough for 13 stripes: "+e;var j=13*i,k=Math.floor(1.9*j);for(c=0;c<13;c+=2)b(c,0);for(c=1;c<13;c+=2)b(c,255);var l=7*i,m=Math.round(.76*j);for(c=0;c<l;c++)for(d=0;d<m;d++)TW.rowMajorAset(h,c,d,0);return h},TW.hexString=function(a,b,c){var d,e,f=0,g="";for(d=0;d<c;d++){var h="";for(e=0;e<b;e++){var i=a[f++];h+=i<16?"0"+i.toString(16):i.toString(16)}g+=h+"\n"}return g},TW.rectangularString=function(a,b,c){var d=a.length;if(d!=b*c)throw"not a rectangular string";var e,f="";for(e=0;e<d;e+=b)f+=a.substr(e,b)+"\n";return f},TW.isArrayRGB=function(a){var b=a.length;if(!b)throw"array does not have length defined; is it even an array? "+a;var c=a.width;if(!c)throw"array does not have width defined: "+a;var d=a.height;if(!d)throw"array does not have height defined: "+a;if(b!=c*d*3)throw"array's width and height and 3 don't multiply to yield the length: "+a;return!0},TW.rowMajorArefRGB=function(a,b,c){TW.isArrayRGB(a);var d=a.height,e=a.width;if(b>d)throw"array row out of bounds: "+b+" > "+d;if(c>e)throw"array col out of bounds: "+c+" > "+e;var f=b*e+c;return[a[3*f+0],a[3*f+1],a[3*f+2]]},TW.rowMajorAsetRGB=function(a,b,c,d,e,f){TW.isArrayRGB(a);var g=a.height,h=a.width;if(b>g)throw"array row out of bounds: "+b+" > "+g;if(c>h)throw"array col out of bounds: "+c+" > "+h;var i=b*h+c;a[3*i+0]=d,a[3*i+1]=e,a[3*i+2]=f},TW.createUSFlagRedWhiteBlue=function(a){function b(a,b,c,d){var e,f,g=a*i,j=(a+1)*i;for(e=g;e<j;e++)for(f=0;f<k;f++)TW.rowMajorAsetRGB(h,e,f,b,c,d)}var c,d,e=TW.power2(a),f=2*e,g=f*e*3,h=new Uint8Array(g);for(h.width=f,h.height=e,c=0;c<g;c++)h[c]=128;var i=Math.floor(e/13);if(i<1)throw"size isn't big enough for 13 stripes: "+e;var j=13*i,k=Math.floor(1.9*j);for(c=0;c<13;c+=2)b(c,255,0,0);for(c=1;c<13;c+=2)b(c,255,255,255);var l=7*i,m=Math.round(.76*j);for(c=0;c<l;c++)for(d=0;d<m;d++)TW.rowMajorAsetRGB(h,c,d,0,0,255);return h},TW.createTriColorFlag=function(a,b,c,d){function e(a,b,c){var d,e,g=new THREE.Color(c),h=255*g.r,j=255*g.g,k=255*g.b;for(d=0;d<f;d++)for(e=a;e<b;e++)TW.rowMajorAsetRGB(i,d,e,h,j,k)}var f=TW.power2(a),g=2*f,h=g*f*3,i=new Uint8Array(h);i.width=g,i.height=f;var j=Math.floor(1*g/3),k=Math.floor(2*g/3);return e(0,j,b),e(j,k,c),e(k,g,d),i},TW.makeFlagTexture=function(a){var b,c,d,e,f;switch(a){case"nascar":b=3,c=TW.createCheckerboardGray(b),d=e=TW.power2(b),f=THREE.LuminanceFormat;break;case"checks":b=3,c=TW.createCheckerboardRedWhite(b),d=e=TW.power2(b),f=THREE.RGBFormat;break;case"US-Gray":b=4,c=TW.createUSFlagGray(b),e=TW.power2(b),d=2*e,f=THREE.LuminanceFormat;break;case"US-RWB":b=4,c=TW.createUSFlagRedWhiteBlue(b),e=TW.power2(b),d=2*e,f=THREE.RGBFormat;break;case"French":b=4,c=TW.createTriColorFlag(b,21924,"white",15679797),e=TW.power2(b),d=2*e,f=THREE.RGBFormat;break;default:throw"don't know this flag nickname: "+a}var g=new THREE.DataTexture(c,d,e,f);return g.minFilter=THREE.NearestFilter,g.magFilter=THREE.NearestFilter,g.needsUpdate=!0,g},TW.stringifyGeometry=function(a){function b(a,b,d){c+="    ("+b+"): "+f[a][b],i||(c+=" "+JSON.stringify(h[a][d])),c+="\n"}if(!a instanceof THREE.Geometry)throw"not a THREE.Geometry: "+a;var c="",d=a.vertices;c+="vertices:\n";for(var e=0;e<d.length;e++)c+="    "+e+": "+JSON.stringify(d[e])+"\n";var f=a.faces,g=a.faces.length,h=a.faceVertexUvs[0],i=0==h.length;i&&(c+="No Vertex UV values\n");var j;for(c+="faces:\n",j=0;j<g;j++){var k=f[j];c+="face "+j+" w/normal: "+JSON.stringify(k.normal)+" and materialIndex: "+k.materialIndex+"\n",b(j,"a",0),b(j,"b",1),b(j,"c",2)}return c},TW.createDifferentColors=function(a){for(var b=[],c=0;c<a;c++){var d=new THREE.Color;d.setHSL(c/a,1,.5),b.push(d)}return b},TW.showFaces=function(a,b){var c,d=a.faces.length,e=TW.createDifferentColors(d),f="<ol>"
;for(c=0;c<d;c++)f+='<li><span style="color:black;background-color:#'+e[c].getHexString()+'">Face '+c+" is in this color</span>";f+="</ol>",document.querySelector(b).innerHTML=f;var g=[];for(c=0;c<d;c++)g.push(new THREE.MeshBasicMaterial({color:e[c].getHex()}));return TW.setMaterialForFaces11(a),new THREE.Mesh(a,new THREE.MeshFaceMaterial(g))},TW.isPowerOf2=function(a){return 0!=a&&!(a&a-1)};var numTexturesToLoad=0;TW.textureMaterial=function(a){console.log("This function is obsolete; use TW.loadTexture(url,cb) and TW.loadTexturesDone(function);"),numTexturesToLoad++;var b=new THREE.ImageUtils.loadTexture(a,new THREE.UVMapping,function(b){if(console.log("loaded: "+a),!TW.isPowerOf2(b.image.width)||!TW.isPowerOf2(b.image.height))throw"Image dimensions are not powers of two: "+a+": "+b.image.width+"x"+b.image.height;0==--numTexturesToLoad&&TW.render()});b.wrapS=THREE.MirroredRepeatWrapping,b.wrapT=THREE.MirroredRepeatWrapping,b.needsUpdate=!0;var c=new THREE.MeshPhongMaterial;return c.map=b,c.name="texture from: "+a,c},TW.textureLoader=new THREE.TextureLoader,TW.loadTexture=function(a,b){TW.textureLoader.load(a,b,function(b){console.log(b.loaded/b.total*100+"% of "+a+" loaded")},function(b){console.log("An error happened loading "+a)})},TW.loadTextures=function(a,b){for(var c=[],d=[],e=a.length,f=0;f<a.length;f++){var g={url:a[f],loaded:!1,texture:null};c.push(g),TW.loadTexture(a[f],function(a){return function(f){var g=c[a];g.loaded=!0,g.texture=f,d[a]=f,e--,e>0?console.log("texture "+a+" loaded; "+e+" to go."):b(d)}}(f))}},TW.createBezierCurve=function(a,b){var c=Math.round(b)+1||20,d=new THREE.Geometry,e=new THREE.CubicBezierCurve3,f=a[0];e.v0=new THREE.Vector3(f[0],f[1],f[2]),f=a[1],e.v1=new THREE.Vector3(f[0],f[1],f[2]),f=a[2],e.v2=new THREE.Vector3(f[0],f[1],f[2]),f=a[3],e.v3=new THREE.Vector3(f[0],f[1],f[2]);var g,h=1/(c-1);for(g=0;g<c;g++)d.vertices.push(e.getPoint(g*h));return d},TW.createPoint=function(a,b,c){b=b||.1,c=c||new THREE.MeshNormalMaterial;var d=new THREE.Mesh(new THREE.SphereGeometry(b),c);return d.position.set(a[0],a[1],a[2]),d},THREE.BezierSurfaceGeometry=function(a,b,c){THREE.Geometry.call(this),this.type="BezierSurfaceGeometry",this.parameters={controlPoints:a,sSegments:b,tSegments:c},this.controlPoints=a,this.sSegments=b,this.tSegments=c,this.computeBezierSurfacePoints(),this.computeBezierSurfaceFaces(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.BezierSurfaceGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.BezierSurfaceGeometry.prototype.computeBezierSurfacePoints=function(){function a(a,b,c){switch(b){case 0:return(1-c)*(1-c)*(1-c);case 1:return 3*c*(1-c)*(1-c);case 2:return 3*c*c*(1-c);case 3:return c*c*c}}var b=this.sSegments,c=this.tSegments,d=this.controlPoints;console.log("computing Bezier surface vertices with: "+b+" and "+c);var e,f,g,h,i=[];for(f=0,h=0;f<=c;f++)for(h=f/c,e=0;e<=b;e++)g=e/b,i.push(function(b,c){var e,f,g=new THREE.Vector3(0,0,0);for(e=0;e<=3;e++)for(f=0;f<=3;f++){var h=a(3,e,b),i=a(3,f,c),j=d[f][e];g.x+=j[0]*h*i,g.y+=j[1]*h*i,g.z+=j[2]*h*i}return console.log("s: "+b+" t: "+c+" x: "+g.x),g}(g,h));return console.log("computed "+i.length+" vertices"),this.vertices=i,i},THREE.BezierSurfaceGeometry.prototype.computeBezierSurfaceFaces=function(){var a,b,c=this.sSegments,d=this.tSegments,e=c,f=d,g=e+1;for(b=0;b<f;b++)for(a=0;a<e;a++){var h=a+g*b,i=a+g*(b+1),j=a+1+g*(b+1),k=a+1+g*b;console.log("vertex indices:\na: "+h+"\nb: "+i+"\nc: "+j+"\nd: "+k);var l=new THREE.Vector2(a/e,1-b/f),m=new THREE.Vector2(a/e,1-(b+1)/f),n=new THREE.Vector2((a+1)/e,1-(b+1)/f),o=new THREE.Vector2((a+1)/e,1-b/f);console.log("corresponding texcoords:\na: ("+l.x+","+l.y+")\nb: ("+m.x+","+m.y+")\nc: ("+n.x+","+n.y+")\nd: ("+o.x+","+o.y+")\n");var p=new THREE.Face3(h,j,i);this.faces.push(p),this.faceVertexUvs[0].push([l,n,m]),p=new THREE.Face3(h,k,j),this.faces.push(p),this.faceVertexUvs[0].push([l.clone(),o,n.clone()])}},TW.vscale=function(a,b){return[a*b[0],a*b[1],a*b[2]]},TW.vadd=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]},TW.vsub=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},TW.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},TW.cross=function(a,b){return[a[1]*b[2]-b[1]*a[2],b[0]*a[2]-a[0]*b[2],a[0]*b[1]-b[0]*a[1]]},TW.perp1=function(a,b){var c=TW.cross(a,b);return TW.cross(c,a)},TW.perp2=function(a,b){var c=TW.dot(a,a),d=TW.dot(a,b);return[c*b[0]-d*a[0],c*b[1]-d*a[1],c*b[2]-d*a[2]]},TW.vec3=function(a){return new THREE.Vector3(a[0],a[1],a[2])},TW.showShaders=function(a){if(a instanceof THREE.Mesh){var b=a.material,c=document.createElement("PRE");c.innerHTML=b.vertexShader;var d=document.createElement("PRE");d.innerHTML=b.fragmentShader;var e=document.createElement("P");e.innerHTML="The object's vertex shader:";var f=document.createElement("P");f.innerHTML="The object's fragment shader:";var g=document.createElement("DIV");g.appendChild(e),g.appendChild(c),g.appendChild(f),g.appendChild(d),document.body.appendChild(g)}},TW.showShaders2=function(a){if(a instanceof THREE.Mesh){var b=a.material.__webglShader,c=document.createElement("PRE");c.innerHTML=b.vertexShader;var d=document.createElement("PRE");d.innerHTML=b.fragmentShader;var e=document.createElement("P");e.innerHTML="The object's vertex shader:";var f=document.createElement("P");f.innerHTML="The object's fragment shader:";var g=document.createElement("DIV");g.appendChild(e),g.appendChild(c),g.appendChild(f),g.appendChild(d),document.body.appendChild(g)}};const KEY_MAPS={27:1,192:14,49:15,50:16,51:17,52:18,53:19,54:20,55:21,56:22,57:23,48:24,173:25,61:26,8:27,9:28,81:29,87:30,69:31,82:32,84:33,89:34,85:35,73:36,79:37,80:38,219:39,221:40,220:41,20:42,65:43,83:44,68:45,70:46,71:47,72:48,74:49,75:50,76:51,59:52,222:53,13:54,16:55,90:56,88:57,67:58,86:59,66:60,78:61,77:62,188:63,190:64,191:65,17:67,18:69,224:70,32:71,37:74,38:75,39:76,40:75};