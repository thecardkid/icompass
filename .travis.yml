cache:
  directories:
  - node_modules

matrix:
  include:
  - language: node_js
    nodejs:
    - '7'
    env:
    - NODE_ENV=test
    before_install:
    - export CHROME_BIN=/usr/bin/google-chrome
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
    - sudo apt-get update
    - sudo apt-get install -y libappindicator1 fonts-liberation
    - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    - sudo dpkg -i google-chrome*.deb
    - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &
    install:
    - npm install -gq --depth 0
    - npm run build
    - MONGO_UNAME=icompass MONGO_PWD=compass78 node icompass &
    script:
    - npm run wdio

  - language: node_js
    nodejs:
    - '7'
    env:
    - NODE_ENV=test
    install:
    - docker pull jvdploeg/node-mocha
    - npm install -gq --depth 0 mocha
    - npm install --depth 0
    script:
    - npm run lint
    - npm run test:mocha
